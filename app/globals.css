@import "tailwindcss";

/* Tailwind v4: use .dark class on <html> instead of @media (prefers-color-scheme: dark).
   Without this, dark: variants always match when the OS is in dark mode,
   making the Light theme impossible to apply. */
@custom-variant dark (&&:where(.dark, .dark *));

/* ========================================
   MINIMAL CSS RESET â€” inside @layer base
   
   CRITICAL: In Tailwind v4, ALL utilities live in @layer utilities.
   Unlayered CSS ALWAYS overrides layered CSS regardless of specificity.
   
   This means element resets like `a { color: inherit }` or
   `button { border: none }` MUST be in @layer base, otherwise they
   override Tailwind utilities like `text-gray-700` or `hover:bg-blue-100`.
   
   Cascade order: @layer base < @layer components < @layer utilities
   So @layer base resets are properly overridden by Tailwind utilities.
   ======================================== */

@layer base {
  *,
  *::before,
  *::after {
    box-sizing: border-box;
  }

  html {
    line-height: 1.15;
    -webkit-text-size-adjust: 100%;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    height: 100%;
  }

  body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
                 'Helvetica Neue', Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    line-height: 1.5;
  }

  /* Remove default margins */
  h1, h2, h3, h4, h5, h6, p, blockquote, pre,
  dl, dd, ol, ul, form, fieldset, legend,
  figure, table, th, td, caption, hr {
    margin: 0;
    padding: 0;
  }

  a {
    background-color: transparent;
    text-decoration: none;
    color: inherit;
  }

  img, picture {
    max-width: 100%;
    display: block;
    border-style: none;
  }

  input, button, textarea, select {
    font: inherit;
  }

  button {
    border: none;
    cursor: pointer;
  }
}

/* ========================================
   CSS CUSTOM PROPERTIES - THEME SYSTEM
   These set variables (not classes) so they're safe.
   ======================================== */

/* Light Theme (Default) */
:root,
[data-theme="light"] {
  --background: #ffffff;
  --background-secondary: #f9fafb;
  --background-tertiary: #f3f4f6;
  --background-elevated: #ffffff;
  --foreground: #111827;
  --foreground-secondary: #4b5563;
  --foreground-muted: #9ca3af;
  --border: #e5e7eb;
  --border-hover: #d1d5db;
  --border-focus: #3b82f6;
  --primary: #3b82f6;
  --primary-hover: #2563eb;
  --primary-foreground: #ffffff;
  --success: #10b981;
  --success-background: #ecfdf5;
  --warning: #f59e0b;
  --warning-background: #fffbeb;
  --error: #ef4444;
  --error-background: #fef2f2;
  --info: #3b82f6;
  --info-background: #eff6ff;
  --card: #ffffff;
  --card-hover: #f9fafb;
  --input-background: #ffffff;
  --input-border: #d1d5db;
  --input-focus: #3b82f6;
  --sidebar-background: #ffffff;
  --sidebar-foreground: #374151;
  --sidebar-hover: #f3f4f6;
  --sidebar-active: #eff6ff;
  --shadow-color: rgba(0, 0, 0, 0.1);
  --shadow-color-lg: rgba(0, 0, 0, 0.15);
}

/* Dark Theme */
[data-theme="dark"],
.dark {
  --background: #0f172a;
  --background-secondary: #1e293b;
  --background-tertiary: #334155;
  --background-elevated: #1e293b;
  --foreground: #f1f5f9;
  --foreground-secondary: #cbd5e1;
  --foreground-muted: #64748b;
  --border: #334155;
  --border-hover: #475569;
  --border-focus: #60a5fa;
  --primary: #60a5fa;
  --primary-hover: #3b82f6;
  --primary-foreground: #0f172a;
  --success: #34d399;
  --success-background: #064e3b;
  --warning: #fbbf24;
  --warning-background: #78350f;
  --error: #f87171;
  --error-background: #7f1d1d;
  --info: #60a5fa;
  --info-background: #1e3a8a;
  --card: #1e293b;
  --card-hover: #334155;
  --quick-actions-bg: #1e293b;
  --input-background: #1e293b;
  --input-border: #475569;
  --input-focus: #60a5fa;
  --sidebar-background: #0f172a;
  --sidebar-foreground: #e2e8f0;
  --sidebar-hover: #1e293b;
  --sidebar-active: #1e3a8a;
  --shadow-color: rgba(0, 0, 0, 0.3);
  --shadow-color-lg: rgba(0, 0, 0, 0.5);
}

/* System preference dark mode */
@media (prefers-color-scheme: dark) {
  [data-theme="system"] {
    --background: #0f172a;
    --background-secondary: #1e293b;
    --background-tertiary: #334155;
    --background-elevated: #1e293b;
    --foreground: #f1f5f9;
    --foreground-secondary: #cbd5e1;
    --foreground-muted: #64748b;
    --border: #334155;
    --border-hover: #475569;
    --border-focus: #60a5fa;
    --primary: #60a5fa;
    --primary-hover: #3b82f6;
    --primary-foreground: #0f172a;
    --success: #34d399;
    --success-background: #064e3b;
    --warning: #fbbf24;
    --warning-background: #78350f;
    --error: #f87171;
    --error-background: #7f1d1d;
    --info: #60a5fa;
    --info-background: #1e3a8a;
    --card: #1e293b;
    --card-hover: #334155;
    --input-background: #1e293b;
    --input-border: #475569;
    --input-focus: #60a5fa;
    --sidebar-background: #0f172a;
    --sidebar-foreground: #e2e8f0;
    --sidebar-hover: #1e293b;
    --sidebar-active: #1e3a8a;
    --shadow-color: rgba(0, 0, 0, 0.3);
    --shadow-color-lg: rgba(0, 0, 0, 0.5);
  }
}

/* ========================================
   TAILWIND v4 THEME BRIDGE
   Connects CSS custom properties to Tailwind theme.
   ======================================== */

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-inter), ui-sans-serif, system-ui, sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Consolas, monospace;
}

/* ========================================
   BODY & DARK MODE ELEMENT STYLES (inside @layer base)
   
   These set actual CSS properties (color, background, border, etc.)
   on elements, so they MUST be in @layer base to not override
   Tailwind v4 utilities.
   ======================================== */

/* html.dark only sets CSS custom properties (--variables),
   which don't conflict with Tailwind utilities. Safe unlayered. */
html.dark {
  --background: #0f172a;
  --background-secondary: #1e293b;
  --background-tertiary: #334155;
  --foreground: #f1f5f9;
  --foreground-secondary: #cbd5e1;
  --foreground-muted: #64748b;
  --border: #334155;
  --card: #1e293b;
}

@layer base {
  body {
    background: var(--background);
    background-color: var(--background);
    color: var(--foreground);
    font-family: var(--font-sans);
  }

  html.dark body {
    background-color: #0f172a;
    color: #f1f5f9;
  }

  /* Form elements dark mode */
  html.dark input,
  html.dark select,
  html.dark textarea {
    background-color: var(--input-background);
    color: var(--foreground);
    border-color: var(--input-border);
  }

  html.dark input::placeholder,
  html.dark textarea::placeholder {
    color: var(--foreground-muted);
  }

  html.dark input:focus,
  html.dark select:focus,
  html.dark textarea:focus {
    border-color: var(--border-focus);
    outline-color: var(--border-focus);
  }

  html.dark option {
    background-color: var(--background-secondary);
    color: var(--foreground);
  }

  /* Quick Actions bar dark mode */
  [data-theme="dark"] [data-testid="dashboard-quick-actions"],
  .dark [data-testid="dashboard-quick-actions"] {
    background-color: var(--background-secondary);
  }

  ::placeholder {
    color: #9ca3af;
    opacity: 1;
  }

  /* Mobile form improvements */
  @media (max-width: 768px) {
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
      min-height: 44px;
      font-size: 16px;
    }
  }

  img {
    aspect-ratio: attr(width) / attr(height);
  }
}

/* Accessibility - reduced motion must use !important to override
   inline styles and animations, and is safe unlayered since it
   only targets pseudo-properties. */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Dev overlays - z-index only, safe unlayered */
.__next-error-overlay,
.__next-dev-overlay {
  z-index: 9999;
}

/* ========================================
   CUSTOM GRID LAYOUTS & UTILITIES
   Custom class names inside @layer components.
   ======================================== */

@layer components {
  .category-analysis-grid {
    display: grid;
    grid-template-columns: 1fr;
  }

  @media (min-width: 1024px) {
    .category-analysis-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  .project-status-grid {
    display: grid;
    grid-template-columns: 1fr;
  }

  @media (min-width: 1024px) {
    .project-status-grid {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }

  .budget-performance-grid,
  .efficiency-metrics-grid {
    display: grid;
    grid-template-columns: 1fr;
  }

  @media (min-width: 1024px) {
    .budget-performance-grid,
    .efficiency-metrics-grid {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }

  /* Mobile: 4 cards in one row; compact so they fit in one line */
  .summary-cards-grid {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 0.5rem;
  }

  @media (min-width: 640px) {
    .summary-cards-grid {
      gap: 1rem;
    }
  }

  @media (min-width: 1024px) {
    .summary-cards-grid {
      gap: 1rem;
    }
  }

  .savings-overruns-grid,
  .cost-analysis-grid {
    display: grid;
    grid-template-columns: 1fr;
  }

  @media (min-width: 1024px) {
    .savings-overruns-grid,
    .cost-analysis-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  .cls-safe {
    contain: layout style paint;
  }

  .content-reserve {
    min-height: var(--min-height, auto);
    contain: layout;
  }

  .gpu-accelerated {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
  }

  .smooth-scroll {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }

  .loading-spinner {
    animation: spin 1s linear infinite;
    border-radius: 9999px;
    border: 2px solid #e5e7eb;
    border-top-color: #3b82f6;
  }
}
